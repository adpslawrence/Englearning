<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>åœ‹ä¸­è‹±èª 1200 å–®å­—å…¨èƒ½ç‹</title>
<style>
    :root {
        --primary: #6c5ce7;
        --primary-dark: #4834d4;
        --secondary: #00cec9;
        --bg: #dfe6e9;
        --surface: #ffffff;
        --text: #2d3436;
        --text-light: #636e72;
        --success: #00b894;
        --error: #d63031;
        --shadow: 0 8px 30px rgba(0,0,0,0.12);
        --radius: 16px;
    }

    [data-theme="dark"] {
        --primary: #a29bfe;
        --primary-dark: #6c5ce7;
        --secondary: #81ecec;
        --bg: #2d3436;
        --surface: #353b48;
        --text: #dfe6e9;
        --text-light: #b2bec3;
        --shadow: 0 8px 30px rgba(0,0,0,0.4);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
        font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        background-color: var(--bg);
        color: var(--text);
        margin: 0;
        padding: 0;
        text-align: center;
        user-select: none;
        padding-bottom: 80px;
        transition: background-color 0.3s, color 0.3s;
        overscroll-behavior-y: none; /* Prevent pull-to-refresh on mobile */
    }

    /* --- Toast Notification System (Replaces Alerts) --- */
    #toast-container {
        position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
        z-index: 10000; pointer-events: none; width: 90%; max-width: 400px;
    }
    .toast {
        background: rgba(45, 52, 54, 0.95); color: white;
        padding: 12px 24px; border-radius: 50px; margin-top: 10px;
        text-align: center; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        animation: slideUp 0.3s ease-out forwards; opacity: 0;
        backdrop-filter: blur(4px);
    }
    .toast.success { background: rgba(0, 184, 148, 0.95); }
    .toast.error { background: rgba(214, 48, 49, 0.95); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }

    /* Header */
    header {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white; padding: 15px;
        box-shadow: 0 4px 20px rgba(108, 92, 231, 0.3);
        position: sticky; top: 0; z-index: 100;
        border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
    }
    .header-content { max-width: 900px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .app-title { margin: 0; font-size: 1.3rem; font-weight: 800; }
    .theme-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; }

    /* Stats Bar */
    .stats-bar {
        display: flex; gap: 8px; margin-top: 10px; overflow-x: auto;
        padding-bottom: 5px; justify-content: center;
        scrollbar-width: none;
    }
    .stats-bar::-webkit-scrollbar { display: none; }
    .stat-pill {
        background: rgba(255,255,255,0.15); padding: 4px 12px; border-radius: 15px;
        font-size: 0.85rem; font-weight: 600; white-space: nowrap; display: flex; align-items: center;
    }
    .stat-pill select { background: transparent; border: none; color: white; font-weight: bold; font-size: 0.85rem; outline: none; }
    .stat-pill select option { background: #333; color: white; }

    /* Main Container */
    .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }

    /* Grid Menu */
    .grid-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; padding: 5px; }
    .menu-card {
        background: var(--surface); padding: 20px; border-radius: var(--radius);
        box-shadow: var(--shadow); cursor: pointer; transition: transform 0.2s, border-color 0.2s;
        display: flex; flex-direction: column; align-items: center; border: 2px solid transparent;
        position: relative; overflow: hidden;
    }
    .menu-card:active { transform: scale(0.96); }
    .menu-card::after {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
        transform: translateX(-100%); transition: 0.5s;
    }
    .menu-card:hover::after { transform: translateX(100%); }
    .menu-icon { font-size: 2.5rem; margin-bottom: 10px; }
    .menu-title { font-weight: 700; color: var(--text); font-size: 1rem; }
    .badge { background: var(--error); color: white; border-radius: 10px; padding: 2px 8px; font-size: 0.75rem; position: absolute; top: 10px; right: 10px; }

    /* Screens */
    .screen {
        display: none; background: var(--surface); border-radius: var(--radius);
        padding: 25px; box-shadow: var(--shadow); min-height: 400px;
        animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); scale: 0.98; } to { opacity: 1; transform: translateY(0); scale: 1; } }

    /* Buttons */
    .btn {
        padding: 12px 24px; font-size: 1rem; border: none; border-radius: 50px;
        cursor: pointer; font-weight: bold; color: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.1s, filter 0.1s;
        display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        -webkit-user-select: none;
    }
    .btn:active { transform: scale(0.95); filter: brightness(0.9); }
    .btn-main { background: var(--primary); }
    .btn-accent { background: var(--secondary); color: #2d3436; }
    .btn-success { background: var(--success); }
    .btn-error { background: var(--error); }
    .back-btn {
        position: absolute; top: 20px; left: 20px;
        background: rgba(178, 190, 195, 0.3); width: 40px; height: 40px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; font-size: 1.2rem; border: none; color: var(--text);
        transition: 0.2s; z-index: 10;
    }
    .back-btn:hover { background: rgba(178, 190, 195, 0.5); }

    /* Interactive Elements */
    .card-area {
        background: var(--bg); border-radius: var(--radius); padding: 30px;
        margin: 20px 0; min-height: 200px; display: flex; flex-direction: column;
        justify-content: center; align-items: center; cursor: pointer;
        border: 2px solid transparent; transition: 0.2s;
    }
    .card-area:active { transform: scale(0.98); background: rgba(0,0,0,0.02); }

    /* Dictionary */
    .search-bar {
        width: 100%; padding: 12px 20px; font-size: 1.1rem;
        border: 2px solid #ddd; border-radius: 50px; margin-bottom: 15px;
        background: var(--bg); color: var(--text); outline: none;
        transition: border-color 0.2s;
    }
    .search-bar:focus { border-color: var(--primary); }
    .alpha-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 5px; margin-bottom: 10px; scrollbar-width: none; }
    .alpha-btn {
        min-width: 40px; height: 40px; border-radius: 12px; background: var(--bg);
        color: var(--text); display: flex; align-items: center; justify-content: center;
        font-weight: bold; cursor: pointer; transition: 0.2s; border: 1px solid transparent;
    }
    .alpha-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); }
    .dict-list { list-style: none; padding: 0; max-height: 50vh; overflow-y: auto; text-align: left; }
    .dict-item {
        background: var(--bg); margin-bottom: 8px; padding: 15px; border-radius: 12px;
        display: flex; justify-content: space-between; align-items: center;
        cursor: pointer; transition: 0.2s;
    }
    .dict-item:active { transform: scale(0.98); }
    .dict-word { font-weight: 800; color: var(--primary); font-size: 1.1rem; }

    /* Scramble Game */
    .drop-zone {
        min-height: 100px; background: var(--bg); border: 2px dashed #b2bec3;
        border-radius: var(--radius); margin: 15px 0; padding: 15px;
        display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; align-content: center;
    }
    .word-tile {
        background: var(--surface); padding: 8px 16px; border-radius: 8px;
        font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        cursor: pointer; user-select: none; border: 1px solid transparent;
        animation: popIn 0.2s;
    }
    .word-tile:active { background: var(--secondary); transform: scale(0.95); }
    @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

    /* Reading */
    .story-item {
        background: var(--bg); padding: 20px; border-radius: 12px; margin-bottom: 10px;
        cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        transition: 0.2s;
    }
    .story-item:hover { background: rgba(0,0,0,0.05); }
    .article-content {
        text-align: left; line-height: 2; font-size: 1.25rem;
        background: var(--bg); padding: 20px; border-radius: 12px;
        max-height: 50vh; overflow-y: auto; margin-bottom: 20px;
    }
    .clickable { cursor: pointer; padding: 0 2px; border-radius: 4px; }
    .clickable:active { background: var(--secondary); color: var(--text); }

    /* Memory Game */
    .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 20px; }
    .memory-card {
        aspect-ratio: 3/4; background: var(--bg); border-radius: 8px;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; font-weight: bold; font-size: 0.9rem; text-align: center;
        transition: transform 0.3s, background 0.3s;
        position: relative; overflow: hidden; border: 2px solid transparent;
    }
    .memory-card.flipped { background: var(--surface); border-color: var(--primary); transform: rotateY(180deg); }
    .memory-card.matched { background: var(--success); color: white; opacity: 0; pointer-events: none; }
    
    /* Reward Button */
    #rewardSection { grid-column: 1 / -1; display: none; margin-top: 15px; }
    .reward-btn {
        background: linear-gradient(45deg, #fd79a8, #e056fd); width: 100%; padding: 15px;
        border-radius: 20px; font-size: 1.2rem; font-weight: bold; color: white;
        border: none; cursor: pointer; animation: pulse 2s infinite;
    }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

    /* Overlays */
    #gameOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 2000;
        display: none; justify-content: center; align-items: center;
        backdrop-filter: blur(5px);
    }
    .game-modal {
        background: var(--surface); width: 90%; max-width: 400px;
        padding: 30px; border-radius: 25px; text-align: center;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
</style>
</head>
<body data-theme="light">

<div id="toast-container"></div>
<canvas id="confettiCanvas"></canvas>

<header>
    <div class="header-content">
        <h1 class="app-title">è‹±èª1200å–®å­—å…¨èƒ½ç‹</h1>
        <button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
    </div>
    
    <div class="stats-bar">
        <div class="stat-pill">ğŸ† <span id="scoreDisplay">0</span></div>
        <div class="stat-pill">ğŸ“š <span id="wordCountDisplay">1200</span> å­—</div>
        <div class="stat-pill">
            ğŸ“Š 
            <select id="levelSelect" onchange="changeLevel()">
                <option value="0">å…¨éƒ¨</option>
                <option value="1">Level 1</option>
                <option value="2">Level 2</option>
                <option value="3">Level 3</option>
            </select>
        </div>
        <div class="stat-pill">ğŸ¢ èªé€Ÿ <input type="range" id="speedRange" min="0.5" max="1.0" step="0.1" value="0.8"></div>
    </div>
</header>

<div class="container">
    <!-- ä¸»é¸å–® -->
    <div id="homeScreen" class="grid-menu">
        <div class="menu-card" onclick="startMode('practice')">
            <span class="menu-icon">ğŸ“‡</span>
            <span class="menu-title">å–®å­—ç·´ç¿’</span>
        </div>
        <div class="menu-card" onclick="startMode('dict')">
            <span class="menu-icon">ğŸ”</span>
            <span class="menu-title">å–®å­—å­—å…¸</span>
        </div>
        <div class="menu-card" onclick="startMode('listen')">
            <span class="menu-icon">ğŸ‘‚</span>
            <span class="menu-title">è½åŠ›æ¸¬é©—</span>
        </div>
        <div class="menu-card" onclick="startMode('speak')">
            <span class="menu-icon">ğŸ—£ï¸</span>
            <span class="menu-title">å£èªªæŒ‘æˆ°</span>
        </div>
        <div class="menu-card" onclick="startMode('read')">
            <span class="menu-icon">ğŸ“–</span>
            <span class="menu-title">çŸ­æ–‡é–±è®€</span>
        </div>
        <div class="menu-card" onclick="startMode('scramble')">
            <span class="menu-icon">ğŸ§©</span>
            <span class="menu-title">å¥å­é‡çµ„</span>
        </div>
        <div class="menu-card" onclick="startMode('mistake')" style="border-color:var(--error);">
            <span class="menu-icon">ğŸ“•</span>
            <span class="menu-title">éŒ¯é¡Œè¤‡ç¿’ <span id="mistakeBadge" class="badge" style="display:none;">0</span></span>
        </div>

        <div id="rewardSection">
            <button class="reward-btn" onclick="openRandomGame()">ğŸ çå‹µæ™‚é–“ï¼(é»æ“ŠéŠç©)</button>
        </div>
    </div>

    <!-- 0. å­—å…¸ -->
    <div id="dictScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2>å–®å­—å°å­—å…¸</h2>
        <input type="text" id="dictInput" class="search-bar" placeholder="è¼¸å…¥å–®å­—æˆ–ä¸­æ–‡..." oninput="searchDict()">
        <div id="alphaFilters" class="alpha-scroll"></div>
        <ul id="dictList" class="dict-list"></ul>
    </div>

    <!-- 1. ç·´ç¿’ -->
    <div id="practiceScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2>å–®å­—å¡</h2>
        <div class="card-area" onclick="togglePracticeCard()">
            <h1 id="pWord" style="font-size:3rem; color:var(--primary); margin:10px 0;">Apple</h1>
            <div id="pHidden" style="display:none; text-align:center;">
                <h2 id="pMean" style="color:var(--text-light);">è˜‹æœ</h2>
                <p id="pSentence" style="color:var(--secondary); font-style:italic; margin-top:15px; font-size:1.1rem;">This is an apple.</p>
            </div>
            <p style="color:var(--text-light); margin-top:30px; font-size:0.9rem;">(é»æ“Šå¡ç‰‡ç¿»é¢)</p>
        </div>
        <div style="display:flex; justify-content:center; gap:15px;">
            <button class="btn btn-main" onclick="playTTS(currWord.word)">ğŸ”Š ç™¼éŸ³</button>
            <button class="btn btn-accent" onclick="nextPractice()">ä¸‹ä¸€å€‹ â¡</button>
        </div>
    </div>

    <!-- 2. è½åŠ› -->
    <div id="listenScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2>è½åŠ›æ¸¬é©—</h2>
        <p>è«‹é»æ“Šå–‡å­ï¼Œé¸å‡ºæ­£ç¢ºçš„ä¸­æ–‡æ„æ€</p>
        <div style="font-size:5rem; cursor:pointer; color:var(--primary); margin:20px; transition:0.2s;" onclick="playTTS(currWord.word)" onmousedown="this.style.transform='scale(0.9)'" onmouseup="this.style.transform='scale(1)'">ğŸ”Š</div>
        <div id="listenOptions" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;"></div>
    </div>

    <!-- 3. å£èªª -->
    <div id="speakScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2>å£èªªæŒ‘æˆ°</h2>
        
        <!-- Mic Test -->
        <div id="micTestZone" style="background:var(--bg); padding:20px; border-radius:15px; border:2px dashed #b2bec3;">
            <h3 style="color:var(--text-light);">éº¥å…‹é¢¨æ¸¬è©¦</h3>
            <button id="btnTestMic" class="btn btn-main" onclick="runMicTest()">ğŸ™ï¸ æ¸¬è©¦ (è«‹èªª "Hello")</button>
            <p id="micStatus" style="margin-top:15px; font-weight:bold; height:25px;">...</p>
            <button id="btnStartSpeakGame" class="btn btn-success" style="display:none; margin-top:15px;" onclick="confirmMicTest()">âœ… é–‹å§‹éŠæˆ²</button>
        </div>

        <!-- Game Zone -->
        <div id="speakGameZone" style="display:none;">
            <h1 id="speakWord" style="font-size:3.5rem; color:var(--primary); margin:10px 0;">Word</h1>
            <p id="speakMean" style="font-size:1.5rem; color:var(--text-light); margin-bottom:30px;">æ„æ€</p>
            
            <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
                <button class="btn btn-main" onclick="playTTS(currWord.word)">ğŸ”Š ç¤ºç¯„</button>
                <button id="btnSpeak" class="btn btn-error" 
                    onmousedown="startRec(event)" onmouseup="stopRec(event)" 
                    ontouchstart="startRec(event)" ontouchend="stopRec(event)"
                    style="min-width:160px;">
                    ğŸ™ï¸ æŒ‰ä½èªªè©±
                </button>
                <button class="btn btn-accent" onclick="initSpeak()">â­ï¸ è·³é</button>
            </div>
            <p style="margin-top:20px;">è¾¨è­˜çµæœ: <span id="speakResult" style="color:var(--primary); font-weight:bold;">...</span></p>
            <p id="speakFeedback" style="height:30px; font-weight:bold;"></p>
        </div>
    </div>

    <!-- 4. é–±è®€ -->
    <div id="readScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2>çŸ­æ–‡é–±è®€</h2>
        
        <div class="category-nav">
            <button class="cat-btn" onclick="selectCategory('family')">å®¶åº­</button>
            <button class="cat-btn" onclick="selectCategory('travel')">æ—…éŠ</button>
            <button class="cat-btn" onclick="selectCategory('animals')">å‹•ç‰©</button>
            <button class="cat-btn" onclick="selectCategory('school')">å­¸æ ¡</button>
            <button class="cat-btn" onclick="selectCategory('food')">é£Ÿç‰©</button>
        </div>

        <div id="storyListArea"></div>

        <div id="readingArea" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <button class="btn btn-accent" onclick="backToStoryList()" style="padding:8px 15px; font-size:0.9rem;">â¬… æ–‡ç« åˆ—è¡¨</button>
                <h3 id="articleTitle" style="color:var(--primary); margin:0;">Title</h3>
                <div style="width:80px;"></div> <!-- Spacer -->
            </div>
            <div id="articleContent" class="article-content"></div>
            <div style="display:flex; justify-content:center; gap:15px;">
                <button class="btn btn-main" onclick="readFullArticle()">ğŸ”Š æœ—è®€å…¨æ–‡</button>
                <button class="btn btn-error" onclick="stopAudio()">â¹ï¸ åœæ­¢</button>
            </div>
        </div>
    </div>

    <!-- 5. å¥å­é‡çµ„ -->
    <div id="scrambleScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2>å¥å­é‡çµ„</h2>
        <p style="color:var(--text-light);">è«‹é»æ“Šå–®å­—ä¾†ç§»å‹•ä½ç½®</p>
        <p style="font-weight:bold; color:var(--primary); margin:15px 0;">æç¤º: <span id="scrambleHint"></span></p>
        
        <div class="drop-zone" id="targetZone"></div>
        <div class="drop-zone" id="sourceZone" style="border:none;"></div>
        
        <div style="display:flex; justify-content:center; gap:10px; margin-top:20px;">
            <button class="btn btn-accent" onclick="resetScramble()">â†º é‡ç½®</button>
            <button class="btn btn-success" onclick="checkScramble()">âœ… æª¢æŸ¥</button>
            <button class="btn btn-main" onclick="initScramble()">â­ï¸ ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <!-- 6. éŒ¯é¡Œè¤‡ç¿’ -->
    <div id="mistakeScreen" class="screen">
        <button class="back-btn" onclick="goHome()">ğŸ </button>
        <h2 style="color:var(--error);">éŒ¯é¡Œè¤‡ç¿’æœ¬</h2>
        <div id="mistakeContent"></div>
        <div style="display:flex; justify-content:center; gap:15px; margin-top:20px;">
            <button class="btn btn-main" onclick="playMistakeTTS()">ğŸ”Š ç™¼éŸ³</button>
            <button class="btn btn-success" onclick="removeMistake()">âœ… æˆ‘æœƒäº†(ç§»é™¤)</button>
            <button class="btn btn-accent" onclick="nextMistake()">ä¸‹ä¸€å€‹ â¡</button>
        </div>
    </div>

</div>

<!-- Mini Game Modal -->
<div id="gameOverlay">
    <div class="game-modal">
        <h2 id="gameTitle" style="color:var(--primary);">Mini Game</h2>
        <div id="gameBody"></div>
        <button class="btn btn-error" onclick="closeGame()" style="margin-top:20px; width:100%;">âŒ é—œé–‰éŠæˆ²</button>
    </div>
</div>

<script>
// --- Data: 1200 Words (Compressed) ---
const packedVocab = `a:ä¸€(å€‹)|able:èƒ½å¤ |about:é—œæ–¼|above:åœ¨...ä¸Šæ–¹|accident:æ„å¤–|across:åœ¨...å°é¢|act:è¡Œå‹•|action:å‹•ä½œ|actor:ç”·æ¼”å“¡|actress:å¥³æ¼”å“¡|actually:å¯¦éš›ä¸Š|add:å¢åŠ |address:åœ°å€|afraid:å®³æ€•|after:ä¹‹å¾Œ|afternoon:ä¸‹åˆ|again:å†|against:å°æŠ—|age:å¹´é½¡|ago:ä»¥å‰|agree:åŒæ„|ahead:å‰æ–¹|air:ç©ºæ°£|airplane:é£›æ©Ÿ|airport:æ©Ÿå ´|all:å…¨éƒ¨|almost:å¹¾ä¹|alone:ç¨è‡ª|along:æ²¿è‘—|already:å·²ç¶“|also:ä¹Ÿ|although:é›–ç„¶|always:ç¸½æ˜¯|am:æ˜¯|America:ç¾åœ‹|American:ç¾åœ‹äºº|and:å’Œ|angry:ç”Ÿæ°£|animal:å‹•ç‰©|another:å¦ä¸€å€‹|answer:ç­”æ¡ˆ|ant:èèŸ»|any:ä»»ä½•|anyone:ä»»ä½•äºº|anything:ä»»ä½•äº‹|apartment:å…¬å¯“|appear:å‡ºç¾|apple:è˜‹æœ|April:å››æœˆ|are:æ˜¯|arm:æ‰‹è‡‚|around:å‘¨åœ|arrive:åˆ°é”|art:è—è¡“|as:åƒ|ask:å•|at:åœ¨|August:å…«æœˆ|aunt:é˜¿å§¨|autumn:ç§‹å¤©|away:é é›¢|baby:å¬°å…’|back:å¾Œé¢|bad:å£|badminton:ç¾½çƒ|bag:è¢‹å­|bake:çƒ¤|bakery:éºµåŒ…åº—|ball:çƒ|balloon:æ°£çƒ|banana:é¦™è•‰|band:æ¨‚åœ˜|bank:éŠ€è¡Œ|barbecue:çƒ¤è‚‰|base:åŸºåœ°|baseball:æ£’çƒ|basket:ç±ƒå­|basketball:ç±ƒçƒ|bat:è™è |bath:æ¾¡|bathroom:æµ´å®¤|be:æ˜¯|beach:æµ·ç˜|bean:è±†å­|bear:ç†Š|beautiful:ç¾|because:å› ç‚º|become:è®Šæˆ|bed:åºŠ|bedroom:è‡¥å®¤|bee:èœœèœ‚|beef:ç‰›è‚‰|before:ä¹‹å‰|begin:é–‹å§‹|behind:å¾Œé¢|believe:ç›¸ä¿¡|bell:éˆ´|belong:å±¬æ–¼|below:ä¸‹é¢|belt:çš®å¸¶|bench:é•·æ¤…|beside:æ—é‚Š|between:ä¹‹é–“|bicycle:å–®è»Š|big:å¤§|bike:å–®è»Š|bird:é³¥|birthday:ç”Ÿæ—¥|bite:å’¬|black:é»‘|blackboard:é»‘æ¿|blanket:æ¯¯å­|blind:ç|block:è¡—å€|blow:å¹|blue:è—|boat:èˆ¹|body:èº«é«”|boil:ç…®|book:æ›¸|bookstore:æ›¸åº—|bored:ç„¡èŠçš„|boring:ç„¡èŠ|born:å‡ºç”Ÿ|borrow:å€Ÿ|boss:è€é—†|both:å…©è€…|bottle:ç“¶å­|bottom:åº•|bow:é èº¬|bowl:ç¢—|box:ç›’|boy:ç”·å­©|bread:éºµåŒ…|break:æ‰“ç ´|breakfast:æ—©é¤|bridge:æ©‹|bright:äº®|bring:å¸¶|brother:å…„å¼Ÿ|brown:è¤|brush:åˆ·|bug:èŸ²|build:è“‹|building:å»ºç¯‰|bun:å°åœ“éºµåŒ…|burn:ç‡’|bus:å…¬è»Š|business:ç”Ÿæ„|businessman:å•†äºº|busy:å¿™|but:ä½†æ˜¯|butter:å¥¶æ²¹|butterfly:è´è¶|buy:è²·|by:è¢«|cage:ç± å­|cake:è›‹ç³•|call:æ‰“é›»è©±|camera:ç›¸æ©Ÿ|camp:éœ²ç‡Ÿ|can:èƒ½|candle:è Ÿç‡­|candy:ç³–æœ|cap:å¸½|car:è»Š|card:å¡|care:é—œå¿ƒ|careful:å°å¿ƒ|carry:å¸¶|case:æ¡ˆå­|castle:åŸå ¡|cat:è²“|catch:æŠ“|celebrate:æ…¶ç¥|cellphone:æ‰‹æ©Ÿ|cent:åˆ†|center:ä¸­å¿ƒ|centimeter:å…¬åˆ†|chair:æ¤…|chalk:ç²‰ç­†|chance:æ©Ÿæœƒ|change:æ”¹|cheap:ä¾¿å®œ|cheat:ä½œå¼Š|check:æŸ¥|cheer:æ­¡å‘¼|cheese:èµ·å¸|chess:æ£‹|chicken:é›|child:å°å­©|China:ä¸­åœ‹|Chinese:ä¸­æ–‡|chocolate:å·§å…‹åŠ›|choose:é¸|chopsticks:ç­·å­|Christmas:è–èª•|church:æ•™å ‚|circle:åœ“|city:å¸‚|clap:æ‹æ‰‹|class:ç­|classmate:åŒå­¸|classroom:æ•™å®¤|clean:ä¹¾æ·¨|clear:æ¸…|clerk:åº—å“¡|climb:çˆ¬|clock:é˜|close:é—œ|clothes:è¡£|cloud:é›²|cloudy:å¤šé›²|club:ç¤¾åœ˜|coat:å¤–å¥—|coffee:å’–å•¡|Coke:å¯æ¨‚|cold:å†·|collect:æ”¶|color:è‰²|comb:æ¢³|come:ä¾†|comfortable:èˆ’æœ|comic:æ¼«ç•«|common:å¸¸è¦‹|computer:é›»è…¦|convenient:æ–¹ä¾¿|cook:ç…®|cookie:é¤…ä¹¾|cool:é…·|copy:æŠ„|corner:è§’|correct:å°|cost:èŠ±è²»|couch:æ²™ç™¼|count:æ•¸|country:åœ‹|course:èª²|cousin:å ‚è¡¨è¦ª|cover:è“‹|cow:ç‰›|cowboy:ç‰›ä»”|crazy:ç˜‹|cross:è·¨|cry:å“­|cup:æ¯|cut:åˆ‡|cute:å¯æ„›|dance:èˆ|dangerous:å±éšª|dark:æš—|date:æ—¥æœŸ|daughter:å¥³å…’|day:å¤©|dead:æ­»|dear:è¦ªæ„›|December:12æœˆ|decide:æ±ºå®š|delicious:å¥½åƒ|dentist:ç‰™é†«|department store:ç™¾è²¨|desk:æ¡Œ|dictionary:å­—å…¸|die:æ­»|different:ä¸åŒ|difficult:é›£|dig:æŒ–|dining room:é£¯å»³|dinner:æ™šé¤|dirty:é«’|dish:ç›¤|do:åš|doctor:é†«|dodge ball:èº²é¿çƒ|dog:ç‹—|doll:å¶|dollar:å…ƒ|door:é–€|dot:é»|down:ä¸‹|dozen:æ‰“|dragon:é¾|draw:ç•«|drawer:æŠ½å±œ|dream:å¤¢|dress:æ´‹è£|drink:å–|drive:é–‹è»Š|driver:å¸æ©Ÿ|drop:æ‰|drum:é¼“|dry:ä¹¾|duck:é´¨|dumpling:é¤ƒ|during:æœŸé–“|each:æ¯|ear:è€³|early:æ—©|earth:åœ°|east:æ±|Easter:å¾©æ´»ç¯€|easy:æ˜“|eat:åƒ|egg:è›‹|eight:8|eighteen:18|eighty:80|either:ä»»ä¸€|elementary school:å°å­¸|elephant:è±¡|eleven:11|else:å…¶ä»–|email:é›»éƒµ|end:æœ«|engineer:å·¥ç¨‹å¸«|English:è‹±èª|enjoy:äº«|enough:å¤ |enter:é€²|envelope:ä¿¡å°|eraser:æ“¦|even:ç”šè‡³|evening:æ™š|ever:æ›¾|every:æ¯|everyone:äººäºº|everything:äº‹äº‹|example:ä¾‹|excellent:æ£’|except:é™¤|excited:èˆˆå¥®|exciting:åˆºæ¿€|excuse:è—‰å£|exercise:é‹å‹•|expensive:è²´|experience:ç¶“é©—|eye:çœ¼|face:è‡‰|fact:äº‹å¯¦|factory:å» |fail:æ•—|fall:ç§‹;è·Œ|family:å®¶|famous:å|fan:æ‰‡|far:é |farm:è¾²|farmer:è¾²å¤«|fast:å¿«|fat:èƒ–|father:çˆ¶|favorite:æœ€æ„›|February:2æœˆ|feed:é¤µ|feel:è¦º|festival:ç¯€|fever:ç‡’|few:å°‘|fifteen:15|fifty:50|fight:æ‰“|fill:å¡«|finally:çµ‚|find:æ‰¾|fine:å¥½|finger:æŒ‡|finish:å®Œ|fire:ç«|first:1st|fish:é­š|fisherman:æ¼å¤«|five:5|fix:ä¿®|floor:åœ°|flower:èŠ±|flute:ç¬›|fly:é£›|follow:è·Ÿ|food:é£Ÿ|foot:è…³|for:ç‚º|foreign:å¤–åœ‹|foreigner:è€å¤–|forget:å¿˜|fork:å‰|forty:40|four:4|fourteen:14|fox:ç‹|free:å…è²»|French fries:è–¯æ¢|fresh:é®®|Friday:é€±äº”|friend:å‹|friendly:å‹å–„|frisbee:é£›ç›¤|frog:è›™|from:å¾|front:å‰|fruit:æœ|fry:ç‚¸|full:æ»¿|fun:æ¨‚|funny:è¶£|future:æœªä¾†|game:æˆ²|garbage:åƒåœ¾|garden:åœ’|gas:æ°£|gate:é–€|get:å¾—|ghost:é¬¼|giant:å·¨|gift:ç¦®|girl:å¥³|give:çµ¦|glad:æ¨‚|glass:ç»|glasses:é¡|glove:å¥—|glue:è† |go:å»|goat:ç¾Š|good:å¥½|goodbye:æ‹œ|goose:éµ|grade:ç´š|gram:å…‹|grandfather:ç¥–çˆ¶|grandmother:ç¥–æ¯|grape:è‘¡è„|grass:è‰|gray:ç°|great:æ£’|green:ç¶ |ground:åœ°|group:çµ„|grow:é•·|guava:èŠ­æ¨‚|guess:çŒœ|guest:å®¢|guide:å°|guitar:å‰ä»–|gun:æ§|guy:å‚¢ä¼™|gym:é«”è‚²é¤¨|habit:ç¿’|hair:é«®|half:åŠ|Halloween:è¬è–|ham:è…¿|hamburger:å ¡|hand:æ‰‹|handsome:å¸¥|hang:æ›|happen:ç™¼ç”Ÿ|happy:æ¨‚|hard:é›£|hat:å¸½|hate:æ¨|have:æœ‰|he:ä»–|head:é ­|headache:é ­ç—›|health:å¥|healthy:åº·|hear:è½|heart:å¿ƒ|heat:ç†±|heavy:é‡|hello:å“ˆå›‰|help:å¹«|helpful:æœ‰ç›Š|hen:æ¯é›|here:é€™|hey:å˜¿|hi:å—¨|hide:è—|high:é«˜|hike:è¡Œ|hill:ä¸˜|hippo:æ²³é¦¬|history:å²|hit:æ‰“|hobby:å—œå¥½|hold:æ‹¿|holiday:å‡|home:å®¶|homework:ä½œæ¥­|honest:èª |honey:èœœ|hop:è·³|hope:å¸Œ|horse:é¦¬|hospital:é†«|hot:ç†±|hot dog:ç†±ç‹—|hotel:æ—…|hour:æ™‚|house:å±‹|housewife:ä¸»å©¦|how:æ€|however:ç„¶|hundred:ç™¾|hungry:é¤“|hunt:çµ|hurry:æ€¥|hurt:å‚·|husband:å¤«|I:æˆ‘|ice:å†°|ice cream:å†°æ·‡æ·‹|idea:æ„|if:è‹¥|important:é‡|in:åœ¨|insect:èŸ²|inside:å…§|interest:è¶£|interested:æ„Ÿèˆˆè¶£|interesting:æœ‰è¶£|Internet:ç¶²|interview:è¨ª|into:å…¥|invite:é‚€|island:å³¶|it:å®ƒ|jacket:å¤¾å…‹|January:1æœˆ|jeans:è¤²|job:å·¥|jog:è·‘|join:åŠ |joy:æ¨‚|juice:æ±|July:7æœˆ|jump:è·³|June:6æœˆ|junior high school:åœ‹ä¸­|just:åª|kangaroo:è¢‹é¼ |keep:ä¿|key:é‘°|kick:è¸¢|kid:å­©|kill:æ®º|kilogram:å…¬æ–¤|kind:é¡|king:ç‹|kiss:å»|kitchen:å»š|kite:ç®|knee:è†|knife:åˆ€|knock:æ•²|know:çŸ¥|knowledge:è­˜|koala:ç„¡å°¾ç†Š|lake:æ¹–|lamp:ç‡ˆ|land:åœ°|language:èª|lantern:ç‡ˆç± |large:å¤§|last:æœ«|late:é²|later:å¾Œ|laugh:ç¬‘|lawyer:å¸«|lazy:æ‡¶|lead:é ˜|leader:é ˜è¢–|learn:å­¸|least:å°‘|leave:é›¢|left:å·¦|leg:è…¿|lemon:æª¬|lend:å€Ÿ|less:å°‘|lesson:èª²|let:è®“|letter:ä¿¡|lettuce:èœ|library:é¤¨|lid:è“‹|lie:è¬Š|life:å‘½|light:å…‰|like:åƒ|line:ç·š|lion:ç…|lip:å”‡|list:å–®|listen:è½|little:å°|live:ä½|living room:å®¢å»³|lonely:å­¤|long:é•·|look:çœ‹|lose:è¼¸|loud:åµ|love:æ„›|lovely:æ„›|low:ä½|lucky:å¹¸|lunch:åˆé¤|machine:æ©Ÿ|mad:æ€’|magic:æ³•|mail:ä¿¡|mailman:éƒµå·®|make:åš|man:ç”·|many:å¤š|map:åœ–|March:3æœˆ|mark:è™Ÿ|marker:ç­†|market:å¸‚|married:å©š|mask:ç½©|mat:å¢Š|math:æ•¸|matter:äº‹|May:5æœˆ|maybe:ä¹Ÿ|meal:é¤|mean:æ„|meat:è‚‰|medicine:è—¥|medium:ä¸­|meet:é‡|meeting:æœƒ|menu:å–®|mile:å“©|milk:å¥¶|million:ç™¾è¬|mind:ä»‹|minute:åˆ†|miss:æƒ³|mistake:éŒ¯|modern:ç¾|moment:åˆ»|Monday:é€±ä¸€|money:éŒ¢|monkey:çŒ´|month:æœˆ|moon:æœˆ|mop:æŠŠ|more:æ›´|morning:æ—©|most:æœ€|mother:æ¯|motorcycle:æ©Ÿè»Š|mountain:å±±|mouse:é¼ |mouth:å˜´|move:å‹•|movie:å½±|Mr.:å…ˆç”Ÿ|Mrs.:å¤ª|MRT:æ·é‹|Ms.:å¥³|much:å¤š|mud:æ³¥|museum:é¤¨|music:æ¨‚|must:å¿…|nail:ç”²|name:å|national:åœ‹|near:è¿‘|neck:é ¸|need:éœ€|neighbor:é„°|never:ä¸|new:æ–°|news:è|next:ä¸‹|nice:å¥½|night:å¤œ|nine:9|nineteen:19|ninety:90|no:ä¸|nobody:ç„¡äºº|nod:é»é ­|noise:éŸ³|noodle:éºµ|noon:åˆ|north:åŒ—|nose:é¼»|not:ä¸|note:è¨˜|notebook:ç­†è¨˜|nothing:æ²’|notice:æ³¨|November:11æœˆ|now:ä»Š|number:æ•¸|nurse:è­·|o'clock:é»|October:10æœˆ|of:çš„|off:é›¢|office:è¾¦|officer:å®˜|often:å¸¸|oil:æ²¹|OK:å¥½|old:è€|on:ä¸Š|once:ä¸€|one:1|only:åª|open:é–‹|or:æˆ–|orange:æ©˜|order:è¨‚|other:å…¶|out:å¤–|outside:å¤–|over:é|own:è‡ª|ox:ç‰›|pack:åŒ…|package:è£¹|page:é |paint:ç•«|pair:é›™|pants:è¤²|papaya:ç“œ|paper:ç´™|parent:è¦ª|park:åœ’|part:éƒ¨|party:æ´¾|pass:é|past:å»|paste:è²¼|pay:ä»˜|PE:é«”è‚²|peach:æ¡ƒ|pear:æ¢¨|pen:ç­†|pencil:é‰›|people:äºº|perhaps:è¨±|person:äºº|pet:å¯µ|phone:é›»|photo:ç…§|piano:ç´|pick:æŒ‘|picnic:é‡|picture:åœ–|pie:æ´¾|piece:ç‰‡|pig:è±¬|pin:é‡|pink:ç²‰|pipe:ç®¡|pizza:æŠ«|place:åœ°|plan:è¨ˆ|planet:æ˜Ÿ|plant:æ¤|plate:ç›¤|play:ç©|player:æ‰‹|playground:å ´|please:è«‹|pleasure:æ¨‚|plus:åŠ |pocket:è¢‹|point:é»|police:è­¦|polite:ç¦®|pond:æ± |pool:æ± |poor:çª®|popcorn:çˆ†|popular:ç´…|pork:è‚‰|possible:å¯|post office:éƒµå±€|postcard:å¡|pot:é‹|pound:ç£…|practice:ç·´|pray:ç¦±|prepare:å‚™|present:ç¦®|pretty:ç¾|price:åƒ¹|prince:ç‹|princess:ä¸»|prize:ç|problem:é¡Œ|program:ç¨‹|proud:å‚²|public:å…¬|pull:æ‹‰|pumpkin:ç“œ|purple:ç´«|push:æ¨|put:æ”¾|quarter:åˆ»|queen:å|question:é¡Œ|quick:å¿«|quiet:éœ|quite:ç•¶|quiz:æ¸¬|rabbit:å…”|race:è³½|radio:æ©Ÿ|railroad:éµ|rain:é›¨|rainbow:è™¹|rainy:é›¨|raise:èˆ‰|rat:é¼ |read:è®€|ready:å‚™|real:çœŸ|really:çœŸ|recorder:ç¬›|red:ç´…|refrigerator:ç®±|remember:è¨˜|repeat:è¤‡|reporter:è¨˜|rest:æ¯|restaurant:å»³|restroom:å»|rice:é£¯|rich:å¯Œ|ride:é¨|right:å³|ring:æˆ’|river:æ²³|road:è·¯|robot:äºº|rock:çŸ³|roll:æ»¾|roller skate:æºœ|room:æˆ¿|rope:ç¹©|rose:ç‘°|round:åœ“|row:åˆ’|rule:è¦|ruler:å°º|run:è·‘|sad:å‚·|safe:å®‰|sail:èˆª|salad:æ‹‰|sale:è³£|salesman:å“¡|salt:é¹½|same:åŒ|sandwich:æ²»|Saturday:é€±å…­|save:å­˜|say:èªª|school:æ ¡|science:ç§‘|scooter:è»Š|screen:å¹•|sea:æµ·|season:å­£|seat:åº§|second:ç§’|secretary:ç§˜|see:çœ‹|seed:ç¨®|seesaw:è¹º|seldom:å°‘|sell:è³£|send:é€|senior high school:é«˜ä¸­|sentence:å¥|September:9æœˆ|serious:åš´|set:çµ„|seven:7|seventeen:17|seventy:70|several:å¹¾|shake:æ–|shall:å°‡|shape:ç‹€|share:äº«|shark:é¯Š|she:å¥¹|sheep:ç¾Š|ship:èˆ¹|shirt:è¡«|shoe:é‹|shop:åº—|shopkeeper:ä¸»|short:çŸ­|shorts:è¤²|should:æ‡‰|shoulder:è‚©|shout:å«|show:ç§€|shy:ç¾|sick:ç—…|side:é‚Š|sidewalk:é“|sight:è¦–|sign:è™Ÿ|simple:ç°¡|since:è‡ª|sing:å”±|singer:æ‰‹|sir:å…ˆç”Ÿ|sister:å¦¹|sit:å|six:6|sixteen:16|sixty:60|size:å¯¸|skate:æºœ|skirt:è£™|sky:å¤©|sleep:ç¡|slide:æ»‘|slim:ç˜¦|slow:æ…¢|small:å°|smart:è°|smell:è|smile:ç¬‘|smoke:ç…™|snack:é£Ÿ|snake:è›‡|snow:é›ª|snowman:äºº|snowy:é›ª|so:æ‰€|soccer:è¶³|socks:è¥ª|sofa:ç™¼|soldier:å…µ|some:äº›|someone:äºº|something:äº‹|sometimes:æ™‚|somewhere:è™•|son:å…’|song:æ­Œ|soon:å¿«|sore:ç—›|sorry:æ­‰|sound:è²|soup:æ¹¯|south:å—|space:ç©º|spaghetti:éºµ|speak:èªª|special:ç‰¹|spell:æ‹¼|spend:èŠ±|spider:è››|spoon:åŒ™|sport:é‹|spring:æ˜¥|square:æ–¹|stairs:æ¢¯|stamp:ç¥¨|stand:ç«™|star:æ˜Ÿ|start:å§‹|station:ç«™|stay:ç•™|steak:æ’|still:ä»|stomach:èƒƒ|stop:åœ|store:åº—|story:æ•…|straight:ç›´|strange:æ€ª|stranger:äºº|strawberry:è“|street:è¡—|strong:å¼·|student:ç”Ÿ|study:è®€|stupid:ç¬¨|subject:ç§‘|successful:æˆ|sugar:ç³–|summer:å¤|sun:æ—¥|Sunday:é€±æ—¥|sunny:æ™´|supermarket:å¸‚|sure:ç¢º|surf:æµª|surprise:é©š|surprised:é©š|sweater:è¡£|sweet:ç”œ|swim:æ³³|swing:é¦|table:æ¡Œ|tail:å°¾|Taiwan:å°|take:æ‹¿|talk:è«‡|tall:é«˜|tape:å¸¶|taste:å‘³|taxi:è¨ˆ|tea:èŒ¶|teach:æ•™|teacher:å¸«|team:éšŠ|teenager:å°‘|telephone:é›»|television:è¦–|tell:å‘Š|temple:å»Ÿ|ten:10|tennis:ç¶²|terrible:ç³Ÿ|test:è€ƒ|than:æ¯”|thank:è¬|that:é‚£|the:é€™|theater:é™¢|then:é‚£|there:é‚£|therefore:å› æ­¤|these:é€™äº›|they:ä»–å€‘|thick:åšçš„|thief:å°å·|thin:è–„çš„|thing:äº‹æƒ…|think:æƒ³|third:ç¬¬ä¸‰|thirsty:å£æ¸´çš„|thirteen:åä¸‰|thirty:ä¸‰å|this:é€™å€‹|those:é‚£äº›|though:é›–ç„¶|thought:æ€æƒ³|thousand:åƒ|thread:ç·š|threaten:å¨è„…|three:ä¸‰|throat:å–‰åš¨|through:ç©¿é|throw:ä¸Ÿ|thumb:æ‹‡æŒ‡|thunder:é›·|Thursday:æ˜ŸæœŸå››|ticket:ç¥¨|tidy:æ•´æ½”çš„|tie:é ˜å¸¶|tiger:è€è™|tight:ç·Šçš„|till:ç›´åˆ°|time:æ™‚é–“|tiny:å¾®å°çš„|tip:å°–ç«¯|tired:ç´¯çš„|title:æ¨™é¡Œ|to:å»|toast:åå¸|today:ä»Šå¤©|toe:è…³è¶¾|tofu:è±†è…|together:ä¸€èµ·|toilet:å»æ‰€|tomato:ç•ªèŒ„|tomorrow:æ˜å¤©|tongue:èˆŒé ­|tonight:ä»Šæ™š|too:å¤ª|tool:å·¥å…·|tooth:ç‰™é½’|toothache:ç‰™ç—›|toothbrush:ç‰™åˆ·|top:é ‚ç«¯|topic:ä¸»é¡Œ|total:ç¸½è¨ˆ|touch:ç¢°è§¸|tough:å …éŸŒçš„|tour:æ—…éŠ|tourist:éŠå®¢|toward:å‘|towel:æ¯›å·¾|tower:å¡”|town:åŸé®|toy:ç©å…·|trace:è¹¤è·¡|track:è»Œé“|trade:è²¿æ˜“|tradition:å‚³çµ±|traditional:å‚³çµ±çš„|traffic:äº¤é€š|train:ç«è»Š|trap:é™·é˜±|trash:åƒåœ¾|travel:æ—…è¡Œ|treasure:å¯¶è—|treat:è«‹å®¢|tree:æ¨¹|triangle:ä¸‰è§’å½¢|trick:æŠŠæˆ²|trip:æ—…è¡Œ|trouble:éº»ç…©|trousers:è¤²å­|truck:å¡è»Š|true:çœŸå¯¦çš„|trumpet:å–‡å­|trust:ä¿¡ä»»|truth:äº‹å¯¦|try:å˜—è©¦|T-shirt:Tæ¤|tub:æµ´ç¼¸|Tuesday:æ˜ŸæœŸäºŒ|tunnel:éš§é“|turkey:ç«é›|turn:è½‰|turtle:çƒé¾œ|twelve:åäºŒ|twenty:äºŒå|twice:å…©æ¬¡|twin:é›™èƒèƒ|two:äºŒ|type:æ‰“å­—|typewriter:æ‰“å­—æ©Ÿ|typhoon:é¢±é¢¨|ugly:é†œé™‹çš„|umbrella:é›¨å‚˜|uncle:å”å”|under:åœ¨...ä¹‹ä¸‹|underline:ç•«åº•ç·š|underpass:åœ°ä¸‹é“|understand:äº†è§£|underwear:å…§è¡£|unhappy:ä¸å¿«æ¨‚çš„|uniform:åˆ¶æœ|unique:ç¨ç‰¹çš„|unit:å–®ä½|universe:å®‡å®™|university:å¤§å­¸|until:ç›´åˆ°|up:å‘ä¸Š|upon:åœ¨...ä¹‹ä¸Š|upper:ä¸Šé¢çš„|upstairs:åœ¨æ¨“ä¸Š|USA:ç¾åœ‹|use:ä½¿ç”¨|useful:æœ‰ç”¨çš„|usual:é€šå¸¸çš„|usually:é€šå¸¸|vacation:å‡æœŸ|valley:å±±è°·|valuable:è²´é‡çš„|value:åƒ¹å€¼|vegetable:è”¬èœ|vendor:å°è²©|very:éå¸¸|vest:èƒŒå¿ƒ|victory:å‹åˆ©|video:å½±ç‰‡|view:æ™¯è‰²|village:æ‘èŠ|vinegar:é†‹|violin:å°æç´|visit:æ‹œè¨ª|visitor:è¨ªå®¢|vocabulary:å­—å½™|voice:è²éŸ³|volleyball:æ’çƒ|vote:æŠ•ç¥¨|waist:è…°|wait:ç­‰å¾…|waiter:ç”·æœå‹™ç”Ÿ|waitress:å¥³æœå‹™ç”Ÿ|wake:é†’ä¾†|walk:èµ°è·¯|walkman:éš¨èº«è½|wall:ç‰†|wallet:éŒ¢åŒ…|want:æƒ³è¦|war:æˆ°çˆ­|warm:æº«æš–çš„|warn:è­¦å‘Š|wash:æ´—|waste:æµªè²»|watch:æ‰‹éŒ¶|water:æ°´|waterfall:ç€‘å¸ƒ|watermelon:è¥¿ç“œ|wave:æ³¢æµª|way:è·¯|we:æˆ‘å€‘|weak:è™›å¼±çš„|wealth:è²¡å¯Œ|wealthy:å¯Œæœ‰çš„|weapon:æ­¦å™¨|wear:ç©¿|weather:å¤©æ°£|wedding:å©šç¦®|Wednesday:æ˜ŸæœŸä¸‰|week:é€±|weekday:å¹³æ—¥|weekend:é€±æœ«|weekly:æ¯é€±çš„|weigh:ç¨±é‡|weight:é‡é‡|welcome:æ­¡è¿|well:å¥½åœ°|west:è¥¿æ–¹|western:è¥¿æ–¹çš„|wet:æ¿•çš„|whale:é¯¨é­š|what:ä»€éº¼|wheel:è¼ªå­|when:ä½•æ™‚|where:å“ªè£¡|whether:æ˜¯å¦|which:å“ªä¸€å€‹|while:ç•¶...æ™‚å€™|white:ç™½è‰²çš„|who:èª°|whole:å…¨éƒ¨çš„|whose:èª°çš„|why:ç‚ºä»€éº¼|wide:å¯¬çš„|wife:å¦»å­|wild:é‡ç”Ÿçš„|will:å°‡|win:è´|wind:é¢¨|window:çª—æˆ¶|windy:å¤šé¢¨çš„|wing:ç¿…è†€|winner:è´å®¶|winter:å†¬å¤©|wire:é‡‘å±¬ç·š|wise:è°æ˜çš„|wish:å¸Œæœ›|with:å’Œ|within:åœ¨...ä¹‹å…§|without:æ²’æœ‰|wolf:ç‹¼|woman:å¥³äºº|wonder:æƒ³çŸ¥é“|wonderful:ç¾å¥½çš„|wood:æœ¨é ­|wooden:æœ¨è£½çš„|wool:ç¾Šæ¯›|word:å­—|work:å·¥ä½œ|workbook:ä½œæ¥­æœ¬|worker:å·¥äºº|world:ä¸–ç•Œ|worm:èŸ²|worry:æ“”å¿ƒ|wound:å—å‚·|wrist:æ‰‹è…•|write:å¯«|writer:ä½œå®¶|wrong:éŒ¯èª¤çš„|yard:åº­é™¢|year:å¹´|yell:å¼å«|yellow:é»ƒè‰²çš„|yes:æ˜¯|yesterday:æ˜¨å¤©|yet:å°šæœª|you:ä½ |young:å¹´è¼•çš„|youth:é’æ˜¥|yummy:å¥½åƒçš„|zebra:æ–‘é¦¬|zero:é›¶|zoo:å‹•ç‰©åœ’`;

// æ“´å……é–±è®€æ•™æ (æ¯é¡ 5 ç¯‡)
const storyData = {
    family: [
        { title: "My Wonderful Family", desc: "æˆ‘çš„ç¾å¥½å®¶åº­", text: "I live in a happy family with four members. My father is a police officer. He is tall, strong, and very brave. My mother is a junior high school teacher. She is beautiful and kind. She loves to cook delicious dinner for us every evening. We live in a comfortable apartment at 101 Park Road. On weekends, we like to watch movies, play cards, and clean the house together." },
        { title: "Grandma's Country House", desc: "ç¥–æ¯çš„é„‰é–“å°å±‹", text: "Every summer vacation, I go to my grandmother's house in the country. It is a small but old house near a river. Grandma has a big garden with many beautiful flowers and trees. She also keeps three fat cats and two smart dogs. In the morning, I help her feed the animals. In the afternoon, she makes sweet apple pies and hot tea for me. We sit under the tree and tell stories." },
        { title: "A Weekend Picnic", desc: "é€±æœ«é‡é¤è¶£", text: "On Sunday, my family went to the park for a picnic. My mother prepared sandwiches and fruit juice. My father brought a big mat and a frisbee. My sister and I played badminton on the grass. The weather was sunny and warm. We ate lunch under a tall tree. A cute squirrel came to our mat to look for food. We gave it some bread. It was a relaxing and happy weekend." },
        { title: "Helping at Home", desc: "å¹«å¿™åšå®¶äº‹", text: "My parents work very hard every day. So, I try to help them with housework. On weekends, I clean my bedroom and wash the dishes after dinner. My brother sweeps the floor and takes out the trash. Sometimes, we wash our father's car together. Working together makes the work easy and fast. My mother says we are good helpers. Seeing their smiles makes me feel proud and happy." },
        { title: "Father's New Job", desc: "çˆ¶è¦ªçš„æ–°å·¥ä½œ", text: "My father got a new job last month. He is now a manager in a computer company. He is very busy and often comes home late. However, he always finds time to talk to us. He asks about our school life and homework. On Sundays, he puts away his cellphone and plays basketball with me. Although he is tired, he cares about us very much. I want to be a hardworking man like him." }
    ],
    travel: [
        { title: "A Trip to Taipei 101", desc: "å°åŒ— 101 ä¹‹æ—…", text: "Last Saturday, my friends and I took a train to Taipei. It was a sunny day. We visited the famous Taipei 101 building. It is a very tall building with 101 floors. We went up to the top floor by a fast elevator. The view was excellent! We could see the whole city clearly. Later, we went to a famous restaurant, Din Tai Fung, to eat dumplings. The food was yummy, but the price was a little expensive." },
        { title: "Summer Beach Fun", desc: "å¤æ—¥æµ·ç˜æ¨‚è¶£", text: "It is very hot in July and August in Taiwan. The temperature is often about 35 degrees Celsius. My favorite activity is going to the beach. I wear my swimsuit and sunglasses. I like to swim in the cool water and look at the colorful fish. Sometimes, I build a sandcastle with my brother. We also play frisbee on the beach. When the sun goes down, we watch the beautiful sunset." },
        { title: "Camping in the Mountains", desc: "å±±ä¸­éœ²ç‡Ÿ", text: "Last summer, my uncle took us camping in the high mountains. We drove for three hours to get there. The air was fresh and cool. We set up a big tent near a clear lake. At night, we made a fire and cooked barbecue. The sky was full of bright stars. I had never seen so many stars before. We slept in sleeping bags and listened to the frogs singing. It was a wonderful experience with nature." },
        { title: "Visiting Tainan", desc: "æ‹œè¨ªå°å—å¤éƒ½", text: "Tainan is an old city in southern Taiwan. It has many famous temples and historic sites. I visited Anping Old Fort with my classmates. We learned a lot about the history of Taiwan. Tainan is also famous for its street food. We ate beef soup and coffin bread. They tasted amazing! The people in Tainan are very friendly. If you like history and food, Tainan is a great place to visit." },
        { title: "A Trip to the Museum", desc: "åšç‰©é¤¨ä¹‹æ—…", text: "Our teacher took us to the National Palace Museum in Taipei. It is a very large museum with many treasures. We saw the Jadeite Cabbage and the Meat-shaped Stone. They looked so real and beautiful. The guide told us interesting stories about these treasures. We walked for two hours and saw many old paintings and pots. I learned that art is very important for our culture." }
    ],
    animals: [
        { title: "A Day at the Zoo", desc: "å‹•ç‰©åœ’çš„ä¸€å¤©", text: "Yesterday, our class visited the city zoo. It is a big place with over 1200 animals. First, we saw the elephants. The elephant has a long trunk and big ears. It is very heavy. Next, we saw the lions. The lion is the king of animals. It has a loud voice that sounds scary. We also watched the monkeys jump between trees. They are funny and smart. I learned a lot about animals. It was an interesting trip." },
        { title: "My Best Friend Lucky", desc: "æˆ‘æœ€å¥½çš„æœ‹å‹ Lucky", text: "I have a pet dog. His name is Lucky. He is a golden retriever with long yellow hair. Lucky is very friendly to people. Every day after school, he waits for me at the door. I take him for a walk in the park. He likes to run fast and catch a ball. He also likes to eat beef and chicken. When I am sad, he sits beside me quietly. Lucky is not just a pet; he is my best friend." },
        { title: "The Smart Dolphin", desc: "è°æ˜çš„æµ·è±š", text: "Dolphins are very smart sea animals. They live in groups and help each other. I saw a dolphin show at the ocean park. The dolphins could jump high out of the water and catch a ball. They could also count numbers and sing songs. The trainer said dolphins are friendly to humans. Sometimes they save people in the sea. I think we should protect the ocean and let dolphins live happily." },
        { title: "Rabbits in the Garden", desc: "èŠ±åœ’è£¡çš„å…”å­", text: "My neighbor has two white rabbits. They have long ears and red eyes. They live in a small house in the garden. I like to feed them carrots and vegetables. When they eat, their mouths move very fast. It is very funny. Rabbits are quiet animals, but they can jump very fast. Sometimes I let them run on the grass. Touching their soft hair makes me feel relaxed." },
        { title: "The King of the Forest", desc: "æ£®æ—ä¹‹ç‹", text: "Tigers are strong and dangerous animals. They live in the forest and hunt for food at night. A tiger has orange fur with black stripes. It helps them hide in the tall grass. Tigers are good swimmers and can climb trees. They usually live alone. Many people are afraid of tigers, but I think they are beautiful. Sadly, there are fewer tigers in the world now. We must save them." }
    ],
    school: [
        { title: "My School Life", desc: "æˆ‘çš„å­¸æ ¡ç”Ÿæ´»", text: "I am a junior high school student. My school is big and modern. There are 25 classrooms, a library, and a gym. I go to school at 7:30 in the morning. My favorite subject is English because the teacher is nice and funny. During the break, I play basketball with my classmates on the playground. Sometimes we go to the library to read books. I study hard every day because I want to be a doctor in the future." },
        { title: "Music Class", desc: "éŸ³æ¨‚èª²çš„æ¨‚è¶£", text: "Today we had a special music class. The teacher brought a guitar and a violin to the classroom. She played a beautiful song for us. Then, she taught us how to sing an English song. Everyone opened their mouths and sang loudly. I felt a little shy at first, but later I enjoyed it. Music makes people feel happy and relaxed. I hope we can have more music classes like this." },
        { title: "Sports Day", desc: "é‹å‹•æœƒ", text: "Yesterday was our school's Sports Day. Every class wore different colored T-shirts. I ran in the 100-meter race. My classmates cheered for me loudly. I ran as fast as I could and won second place. We also had a relay race and a tug-of-war. Everyone tried their best for their class. Although we were tired and sweaty, we felt very happy. Sports Day teaches us about teamwork and never giving up." },
        { title: "My Favorite Library", desc: "æˆ‘æœ€æ„›çš„åœ–æ›¸é¤¨", text: "The school library is my favorite place. It is quiet and bright. There are thousands of books on the shelves. I like to go there during lunch break. I usually read books about science and history. The librarian is a kind lady. She helps me find good books to read. Reading books allows me to travel to different worlds and learn new things. I think reading is a good habit for everyone." },
        { title: "Cleaning Time", desc: "æ‰“æƒæ™‚é–“", text: "Every day at 3 pm, it is cleaning time at our school. All students work together to clean the campus. Some students sweep the floor in the classroom. Others clean the windows and the blackboard. My job is to wipe the desks and arrange the chairs. We want to keep our school clean and tidy. A clean environment helps us learn better. I am happy to do my part for the school." }
    ],
    food: [
        { title: "Making a Birthday Cake", desc: "è£½ä½œç”Ÿæ—¥è›‹ç³•", text: "Today is my mother's birthday. My father and I decided to make a cake for her. First, we bought flour, sugar, and butter from the supermarket. Then, we mixed 3 eggs and 2 cups of milk in a bowl. We baked the cake in the oven for 40 minutes. It smelled very good! Finally, we put some fresh strawberries and cream on top. Mother was very surprised and happy. The cake tasted sweet and delicious." },
        { title: "Lunch Time", desc: "åˆé¤æ™‚å…‰", text: "It is 12 o'clock. It is time for lunch. I am very hungry. Today's lunch is rice with pork and vegetables. The pork is salty but tasty. The cabbage is fresh and green. I also have a bowl of corn soup. It is hot and sweet. After the meal, I eat a guava as fruit. Eating healthy food is important for our body. I finish everything on my plate. I am full and ready for the afternoon class." },
        { title: "Night Market Food", desc: "å¤œå¸‚ç¾é£Ÿ", text: "Taiwan is famous for its night markets. There are many kinds of delicious food there. Last night, I went to the Shilin Night Market. I ate a large fried chicken steak. It was crispy and juicy. Then I drank a cup of bubble milk tea. The pearls were sweet and chewy. I also tried stinky tofu. It smelled strong but tasted good. Night markets are the best place to enjoy Taiwanese food." },
        { title: "Healthy Breakfast", desc: "å¥åº·æ—©é¤", text: "Breakfast is the most important meal of the day. My mother always prepares a healthy breakfast for me. Usually, I have a glass of milk and an egg. Sometimes I eat toast with cheese and ham. Eating a good breakfast gives me energy to study and play. If I don't eat breakfast, I feel tired and cannot focus in class. I love eating breakfast with my family every morning." },
        { title: "Fruit in Taiwan", desc: "å°ç£çš„æ°´æœ", text: "Taiwan has many delicious fruits. In summer, we have sweet watermelons and mangoes. Mango shaved ice is my favorite dessert. In winter, we have strawberries and oranges. Bananas and papayas are available all year round. Fruits are rich in vitamins and good for our health. I eat fruit every day after lunch. My foreign friends also love Taiwanese fruit. They say it is the best fruit in the world." }
    ]
};

// Global Variables
let vocabList = [];
let mistakeList = [];
let score = 0;
let unlockScore = 150;
let rewardGamesLeft = 0;
let currWord = null;
let currMistakeIndex = 0;
let currentLevel = 0; // 0=All, 1, 2, 3
let synth = window.speechSynthesis;
let recognition;
let isRecognizing = false;

// --- Initialization ---
window.onload = function() {
    initVocab();
    initSpeechRecognition();
    selectCategory('family');
    updateStats();
    initAlphaScroll();
    initConfetti();
    
    // Load persisted data if needed (optional)
    if(localStorage.getItem('mistakeList')) {
        try { mistakeList = JSON.parse(localStorage.getItem('mistakeList')); updateMistakeBadge(); } catch(e){}
    }
};

function initVocab() {
    let idCounter = 1;
    const lines = packedVocab.split('|');
    const total = lines.length;
    const chunkSize = Math.ceil(total / 3);

    lines.forEach((item, index) => {
        if(!item) return;
        const parts = item.split(':');
        if(parts.length >= 2) {
            const w = parts[0].trim();
            const m = parts[1].trim();
            // Generate sentence based on word type
            const s = makeSent(w);
            let lvl = 1;
            if (index > chunkSize) lvl = 2;
            if (index > chunkSize * 2) lvl = 3;

            vocabList.push({ id: idCounter++, word: w, mean: m, sentence: s, level: lvl });
        }
    });
    console.log(`Loaded ${vocabList.length} words.`);
    const countDisplay = document.getElementById('wordCountDisplay');
    if (countDisplay) {
        countDisplay.innerText = vocabList.length;
    }
}

// --- Helper Functions ---
function showToast(msg, type = 'success') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerText = msg;
    container.appendChild(toast);
    setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s forwards';
        setTimeout(() => toast.remove(), 300);
    }, 2000);
}

function playTTS(txt) {
    if(synth.speaking) synth.cancel();
    let u = new SpeechSynthesisUtterance(txt);
    u.rate = document.getElementById('speedRange').value;
    u.lang = 'en-US';
    synth.speak(u);
}
function stopAudio() { if(synth.speaking) synth.cancel(); }

function toggleTheme() {
    const body = document.body;
    body.setAttribute('data-theme', body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
}

function updateStats() {
    const scoreDisplay = document.getElementById('scoreDisplay');
    if (scoreDisplay) scoreDisplay.innerText = score;
    if (score >= unlockScore && rewardGamesLeft === 0) {
        unlockScore += 150; rewardGamesLeft = 3;
        const rewardSection = document.getElementById('rewardSection');
        if (rewardSection) rewardSection.style.display = 'block';
        showToast("ğŸ çå‹µéŠæˆ²å·²è§£é–ï¼", "success");
    }
    const btn = document.querySelector('.reward-btn');
    if(btn) btn.innerText = `ğŸ çå‹µæ™‚é–“ï¼(å‰©é¤˜ ${rewardGamesLeft} æ¬¡)`;
    
    if (rewardGamesLeft <= 0) {
        const rewardSection = document.getElementById('rewardSection');
        if (rewardSection) rewardSection.style.display = 'none';
    }
}

function addScore(p) { score += p; updateStats(); }

// --- Sentence Generator ---
const irregularVerbs = { 'go':'went', 'see':'saw', 'eat':'ate', 'drink':'drank', 'buy':'bought', 'run':'ran', 'swim':'swam', 'write':'wrote', 'read':'read', 'come':'came' };
const collocations = { 'homework': 'do homework', 'bus': 'take a bus', 'photo': 'take a photo', 'piano': 'play the piano', 'song': 'sing a song', 'bed': 'go to bed' };

function makeSent(w) {
    const wordLower = w.toLowerCase();
    const isVowel = /^[aeiou]/i.test(w);
    const article = isVowel ? "an" : "a";
    
    if (collocations[wordLower]) return `I like to ${collocations[wordLower]}.`;

    const safeTemplates = [
        `How do you spell "${w}"?`,
        `The word is "${w}".`,
        `Please write "${w}".`,
        `Do you know "${w}"?`,
        `We learned "${w}" today.`
    ];

    // Simple heuristic lists
    const commonNouns = ['apple','banana','cat','dog','egg','fan','girl','hat','ice','jacket','kite','lion','monkey','nose','orange','pig','queen','rabbit','snake','tiger','umbrella','vest','watch','box','zoo','bird','book','pen','pencil','desk','chair','car','bus','park','school','teacher','student','father','mother','brother','sister','hand','foot','eye','ear','mouth'];
    const commonVerbs = ['run','jump','swim','eat','drink','sleep','go','come','walk','fly','sing','dance','play','read','write','cook','wash','watch','listen','study','learn'];
    const commonAdjs = ['good','bad','happy','sad','big','small','hot','cold','tall','short','long','fat','thin','hungry','thirsty','beautiful','cute','fast','slow','old','new','young'];

    let specificTemplates = [];

    if (commonNouns.includes(wordLower) || /(er|or|ist|tion|ment)$/.test(w)) { 
        specificTemplates.push(`This is ${article} ${w}.`);
        specificTemplates.push(`I see ${article} ${w}.`);
        specificTemplates.push(`The ${w} is here.`);
    } 
    else if (commonVerbs.includes(wordLower) || /(ize|ify|ate)$/.test(w)) {
        specificTemplates.push(`I like to ${w}.`);
        specificTemplates.push(`Can you ${w}?`);
        if(irregularVerbs[wordLower]) {
            specificTemplates.push(`Yesterday I ${irregularVerbs[wordLower]}.`);
        } else {
            specificTemplates.push(`Let's ${w} together.`);
        }
    } 
    else if (commonAdjs.includes(wordLower) || /(ful|ous|ive|ble)$/.test(w)) {
        specificTemplates.push(`It is very ${w}.`);
        specificTemplates.push(`She feels ${w}.`);
        specificTemplates.push(`It looks ${w}.`);
    }

    if (specificTemplates.length > 0) {
        const pool = [...specificTemplates, ...specificTemplates, ...safeTemplates];
        return pool[Math.floor(Math.random() * pool.length)];
    }
    return safeTemplates[Math.floor(Math.random() * safeTemplates.length)];
}

// --- Navigation ---
function goHome() {
    stopAudio();
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('homeScreen').style.display = 'grid';
}

function startMode(id) {
    stopAudio();
    document.getElementById('homeScreen').style.display = 'none';
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id+'Screen').classList.add('active');
    
    // Init logic per screen
    if(id==='practice') nextPractice();
    if(id==='listen') initListen();
    if(id==='speak') initSpeakSetup();
    if(id==='scramble') initScramble();
    if(id==='dict') initDict();
    if(id==='mistake') initMistakeReview();
}

function changeLevel() {
    currentLevel = parseInt(document.getElementById('levelSelect').value);
    showToast(`åˆ‡æ›è‡³ Level ${currentLevel === 0 ? 'All' : currentLevel}`);
    nextPractice();
}

function getFilteredVocab() {
    if(currentLevel === 0) return vocabList;
    return vocabList.filter(v => v.level === currentLevel);
}

// --- 1. Practice ---
function nextPractice() {
    let pool = getFilteredVocab();
    if(pool.length === 0) pool = vocabList;
    currWord = pool[Math.floor(Math.random()*pool.length)];
    
    document.getElementById('pWord').innerText = currWord.word;
    document.getElementById('pHidden').style.display = 'none';
    document.getElementById('pMean').innerText = currWord.mean;
    document.getElementById('pSentence').innerText = currWord.sentence;
}
function togglePracticeCard() {
    let el = document.getElementById('pHidden');
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
    if(el.style.display === 'block') playTTS(currWord.word);
}

// --- 2. Listen ---
function initListen() {
    let pool = getFilteredVocab();
    if(pool.length < 4) pool = vocabList;
    
    currWord = pool[Math.floor(Math.random()*pool.length)];
    
    let opts = [currWord];
    while(opts.length<4) {
        let r = pool[Math.floor(Math.random()*pool.length)];
        if(!opts.includes(r)) opts.push(r);
    }
    opts.sort(()=>Math.random()-0.5);
    
    let div = document.getElementById('listenOptions');
    div.innerHTML = "";
    opts.forEach(o => {
        let btn = document.createElement('button');
        btn.className = 'btn btn-accent';
        btn.style.width = '100%'; btn.style.height = '60px'; btn.style.fontSize = '1.1rem';
        btn.innerText = o.mean;
        btn.onclick = () => {
            if(o.id === currWord.id) {
                showToast("âœ… ç­”å°äº†ï¼+10");
                fireConfetti(); addScore(10);
                setTimeout(initListen, 800);
            } else {
                showToast("âŒ éŒ¯èª¤ï¼Œå·²åŠ å…¥éŒ¯é¡Œæœ¬", "error");
                playTTS(currWord.word);
                addMistake(currWord);
            }
        };
        div.appendChild(btn);
    });
    setTimeout(()=>playTTS(currWord.word), 300);
}

// --- 3. Speak ---
function initSpeechRecognition() {
    if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.continuous = false;
        recognition.interimResults = false;
        
        recognition.onstart = () => { isRecognizing = true; };
        recognition.onend = () => { isRecognizing = false; };
        recognition.onresult = (e) => checkSpeaking(e.results[0][0].transcript);
    }
}

function initSpeakSetup() {
    document.getElementById('micTestZone').style.display = 'flex';
    document.getElementById('speakGameZone').style.display = 'none';
    document.getElementById('micStatus').innerText = "...";
    document.getElementById('btnStartSpeakGame').style.display = 'none';
}

function runMicTest() {
    const status = document.getElementById('micStatus');
    status.innerText = "è«‹èªªè©±...";
    
    if(!recognition) {
        initSpeechRecognition();
        if(!recognition) { status.innerText = "âŒ ç€è¦½å™¨ä¸æ”¯æ´"; return; }
    }
    if(isRecognizing) return;

    recognition.onresult = (e) => {
        status.innerText = `OK: "${e.results[0][0].transcript}"`;
        document.getElementById('btnStartSpeakGame').style.display = 'inline-block';
        recognition.stop();
    };
    recognition.onerror = () => { status.innerText = "âŒ ç„¡æ³•è¾¨è­˜"; };
    try { recognition.start(); } catch(e) { recognition.stop(); }
}

function confirmMicTest() {
    document.getElementById('micTestZone').style.display = 'none';
    document.getElementById('speakGameZone').style.display = 'block';
    initSpeak();
}

function initSpeak() {
    let pool = getFilteredVocab();
    currWord = pool[Math.floor(Math.random()*pool.length)];
    document.getElementById('speakWord').innerText = currWord.word;
    document.getElementById('speakMean').innerText = currWord.mean;
    document.getElementById('speakResult').innerText = "...";
    document.getElementById('speakFeedback').innerText = "";
    
    if(recognition) {
        recognition.onresult = (e) => checkSpeaking(e.results[0][0].transcript);
        recognition.onerror = () => { document.getElementById('speakFeedback').innerText = "âŒ éŒ¯èª¤"; };
    }
}

function startRec(e) {
    if(e) { e.preventDefault(); e.stopPropagation(); }
    const btn = document.getElementById('btnSpeak');
    if(recognition && !isRecognizing) {
        try {
            recognition.start();
            btn.style.background = "#d63031"; btn.innerText = "ğŸ‘‚ è†è½ä¸­...";
        } catch(ex) {}
    }
}

function stopRec(e) {
    if(e) { e.preventDefault(); e.stopPropagation(); }
    const btn = document.getElementById('btnSpeak');
    setTimeout(() => {
        if(recognition && isRecognizing) {
            try {
                recognition.stop();
                btn.style.background = ""; btn.innerText = "ğŸ™ï¸ æŒ‰ä½èªªè©±";
            } catch(ex) {}
        }
    }, 500);
}

function checkSpeaking(txt) {
    let clean = txt.toLowerCase().trim();
    document.getElementById('speakResult').innerText = clean;
    if(clean.includes(currWord.word.toLowerCase())) {
        showToast("âœ… ç™¼éŸ³æ­£ç¢ºï¼+10");
        fireConfetti(); addScore(10);
        setTimeout(initSpeak, 1500);
    } else {
        showToast("âŒ å†è©¦ä¸€æ¬¡", "error");
        addMistake(currWord);
    }
}

// --- 4. Read ---
function selectCategory(cat) {
    document.getElementById('storyListArea').style.display = 'grid';
    document.getElementById('readingArea').style.display = 'none';
    let listDiv = document.getElementById('storyListArea'); listDiv.innerHTML = "";
    
    storyData[cat].forEach((story, index) => {
        let btn = document.createElement('div');
        btn.className = 'story-item';
        btn.innerHTML = `<div><div style='font-weight:bold; font-size:1.1rem;'>${story.title}</div><div style='color:var(--text-light); font-size:0.9rem'>${story.desc}</div></div><div style='color:var(--primary); font-size:1.5rem'>âœ</div>`;
        btn.onclick = () => openStory(cat, index);
        listDiv.appendChild(btn);
    });
}

function openStory(cat, index) {
    let story = storyData[cat][index];
    document.getElementById('storyListArea').style.display = 'none';
    document.getElementById('readingArea').style.display = 'block';
    document.getElementById('articleTitle').innerText = story.title;
    let html = "";
    story.text.split(" ").forEach(w => {
        let clean = w.replace(/[.,?!]/g, ""); 
        html += `<span class="clickable" onclick="playTTS('${clean}')">${w} </span>`;
    });
    document.getElementById('articleContent').innerHTML = html;
}

function backToStoryList() {
    stopAudio();
    document.getElementById('readingArea').style.display = 'none';
    document.getElementById('storyListArea').style.display = 'grid';
}

function readFullArticle() {
    playTTS(document.getElementById('articleContent').innerText);
}

// --- 5. Scramble ---
function initScramble() {
    let pool = getFilteredVocab();
    currWord = pool[Math.floor(Math.random()*pool.length)];
    // Ensure complexity
    while(currWord.sentence.split(" ").length < 3) {
         currWord = pool[Math.floor(Math.random()*pool.length)];
    }
    
    let sent = currWord.sentence.replace(/[.,?!]/g,""); 
    let parts = sent.split(" ").sort(()=>Math.random()-0.5);
    
    document.getElementById('scrambleHint').innerText = `${currWord.word} (${currWord.mean})`;
    document.getElementById('targetZone').innerHTML = "";
    let src = document.getElementById('sourceZone'); src.innerHTML = "";
    
    parts.forEach((p,i) => {
        let div = document.createElement('div');
        div.className = 'word-tile';
        div.innerText = p;
        // Tap to move logic for mobile
        div.onclick = function() {
            if(this.parentElement.id === 'sourceZone') document.getElementById('targetZone').appendChild(this);
            else document.getElementById('sourceZone').appendChild(this);
        };
        src.appendChild(div);
    });
}

function resetScramble() {
    let t = document.getElementById('targetZone');
    let s = document.getElementById('sourceZone');
    while(t.childNodes.length > 0) s.appendChild(t.childNodes[0]);
}

function checkScramble() {
    let ans = Array.from(document.querySelectorAll('#targetZone .word-tile')).map(x=>x.innerText).join(" ");
    let correct = currWord.sentence.replace(/[.,?!]/g,"");
    if(ans === correct) {
        showToast("âœ… å¥å­æ­£ç¢ºï¼+15");
        fireConfetti(); addScore(15); playTTS(currWord.sentence);
        setTimeout(initScramble, 1500);
    } else {
        showToast("âŒ é †åºéŒ¯èª¤", "error");
        addMistake(currWord);
    }
}

// --- 6. Mistakes ---
function addMistake(w) {
    if(!mistakeList.some(m => m.id === w.id)) {
        mistakeList.push(w);
        updateMistakeBadge();
        localStorage.setItem('mistakeList', JSON.stringify(mistakeList));
    }
}

function updateMistakeBadge() {
    const b = document.getElementById('mistakeBadge');
    if (b) {
        b.innerText = mistakeList.length;
        b.style.display = mistakeList.length > 0 ? 'inline-block' : 'none';
    }
}

function initMistakeReview() {
    if(mistakeList.length === 0) {
        document.getElementById('mistakeContent').innerHTML = "<h3 style='color:var(--text-light)'>å¤ªæ£’äº†ï¼ç›®å‰æ²’æœ‰éŒ¯é¡Œã€‚</h3>";
        return;
    }
    showMistakeCard(0);
}

function showMistakeCard(idx) {
    if(idx >= mistakeList.length) idx = 0;
    currMistakeIndex = idx;
    const w = mistakeList[idx];
    document.getElementById('mistakeContent').innerHTML = `
        <div class="card-area" style="border-color:var(--error);">
            <h1 style="color:var(--error); font-size:2.5rem;">${w.word}</h1>
            <h2 style="color:var(--text);">${w.mean}</h2>
            <p style="color:var(--text-light); margin-top:10px;">${w.sentence}</p>
            <div style="margin-top:20px; color:var(--text-light); font-size:0.8rem;">(å‰©é¤˜: ${mistakeList.length})</div>
        </div>
    `;
    playTTS(w.word);
}

function nextMistake() {
    if(mistakeList.length === 0) return;
    showMistakeCard(currMistakeIndex + 1);
}

function playMistakeTTS() {
    if(mistakeList.length > 0) playTTS(mistakeList[currMistakeIndex].word);
}

function removeMistake() {
    if(mistakeList.length === 0) return;
    mistakeList.splice(currMistakeIndex, 1);
    updateMistakeBadge();
    localStorage.setItem('mistakeList', JSON.stringify(mistakeList));
    if(mistakeList.length === 0) initMistakeReview();
    else showMistakeCard(currMistakeIndex);
}

// --- 0. Dict ---
function initDict() {
    document.getElementById('dictInput').value = "";
    document.getElementById('dictList').innerHTML = "";
}

function initAlphaScroll() {
    let c = document.getElementById('alphaFilters'); c.innerHTML = "";
    for(let i=65; i<=90; i++) {
        let btn = document.createElement('div');
        btn.className = 'alpha-btn'; btn.innerText = String.fromCharCode(i);
        btn.onclick = () => filterByLetter(btn.innerText, btn);
        c.appendChild(btn);
    }
}

function filterByLetter(char, btn) {
    document.querySelectorAll('.alpha-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('dictInput').value = "";
    let matches = vocabList.filter(v => v.word.toUpperCase().startsWith(char));
    renderDict(matches);
}

function searchDict() {
    document.querySelectorAll('.alpha-btn').forEach(b => b.classList.remove('active'));
    let v = document.getElementById('dictInput').value.trim().toLowerCase();
    if(!v) { document.getElementById('dictList').innerHTML=""; return; }
    
    // Improved search: Match English start OR Chinese inclusion
    let matches = vocabList.filter(w => w.word.toLowerCase().startsWith(v) || w.mean.includes(v));
    // If few results, verify contains for English too
    if(matches.length < 5) {
        let more = vocabList.filter(w => w.word.toLowerCase().includes(v) && !matches.includes(w));
        matches = [...matches, ...more];
    }
    renderDict(matches, true);
}

function renderDict(matches, limit=false) {
    let list = document.getElementById('dictList'); list.innerHTML = "";
    if(matches.length===0) { list.innerHTML="<li style='padding:15px'>ç„¡çµæœ</li>"; return; }
    
    let max = limit ? 50 : 200;
    matches.slice(0, max).forEach(w => {
        let li = document.createElement('li');
        li.className = 'dict-item';
        li.innerHTML = `<div><span class="dict-word">${w.word}</span> <span class="dict-mean">${w.mean}</span></div><button class="btn btn-main" style="padding:5px 12px; font-size:0.8rem" onclick="event.stopPropagation(); playTTS('${w.word}')">ğŸ”Š</button>`;
        li.onclick = () => playTTS(w.word);
        list.appendChild(li);
    });
}

// --- Games ---
function openRandomGame() {
    if(rewardGamesLeft <= 0) return;
    document.getElementById('gameOverlay').style.display = 'flex';
    let body = document.getElementById('gameBody'); body.innerHTML = "";
    let type = Math.random() > 0.5 ? 'math' : 'memory';
    if(type === 'math') setupMathGame(body);
    else setupMemoryGame(body);
}

function closeGame() {
    document.getElementById('gameOverlay').style.display = 'none';
    rewardGamesLeft--; updateStats();
}

function setupMathGame(c) {
    document.getElementById('gameTitle').innerText = "æ•¸å­¸æŒ‘æˆ°";
    let n1 = Math.floor(Math.random()*10)+1, n2 = Math.floor(Math.random()*10)+1;
    let map = ['zero','one','two','three','four','five','six','seven','eight','nine','ten','eleven','twelve','thirteen','fourteen','fifteen','sixteen','seventeen','eighteen','nineteen','twenty'];
    let ans = n1 + n2;
    c.innerHTML = `<h2 style="margin-bottom:20px;">${map[n1]} + ${map[n2]} = ?</h2><div id="mOpts" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>`;
    let opts = [ans, ans+1, ans-1, ans+2].sort(()=>Math.random()-0.5).slice(0,4);
    opts.forEach(o => {
        let b = document.createElement('button'); b.className = 'btn btn-main'; b.innerText = map[o] || o;
        b.onclick = () => {
            if(o === ans) { showToast("âœ… æ­£ç¢ºï¼+30"); addScore(30); closeGame(); }
            else showToast("âŒ éŒ¯èª¤", "error");
        };
        document.getElementById('mOpts').appendChild(b);
    });
}

function setupMemoryGame(c) {
    document.getElementById('gameTitle').innerText = "è¨˜æ†¶ç¿»ç‰Œ";
    let pool = [...vocabList].sort(()=>Math.random()-0.5).slice(0,4);
    let cards = [];
    pool.forEach(w => {
        cards.push({ id: w.id, txt: w.word, type: 'en' });
        cards.push({ id: w.id, txt: w.mean, type: 'ch' });
    });
    cards.sort(()=>Math.random()-0.5);
    
    let grid = document.createElement('div'); grid.className = 'memory-grid';
    let first = null, lock = false, done = 0;
    
    cards.forEach(card => {
        let el = document.createElement('div'); el.className = 'memory-card';
        el.dataset.id = card.id;
        el.innerHTML = `<span>${card.txt}</span>`;
        el.querySelector('span').style.opacity = '0';
        
        el.onclick = function() {
            if(lock || this === first || this.classList.contains('matched')) return;
            this.classList.add('flipped');
            this.querySelector('span').style.opacity = '1';
            
            if(!first) { first = this; return; }
            
            lock = true;
            if(first.dataset.id === this.dataset.id) {
                setTimeout(() => {
                    first.classList.add('matched'); this.classList.add('matched');
                    first = null; lock = false; done++;
                    if(done === 4) { showToast("ğŸ† é€šé—œï¼+50"); addScore(50); closeGame(); }
                }, 600);
            } else {
                setTimeout(() => {
                    first.classList.remove('flipped'); first.querySelector('span').style.opacity = '0';
                    this.classList.remove('flipped'); this.querySelector('span').style.opacity = '0';
                    first = null; lock = false;
                }, 1000);
            }
        };
        grid.appendChild(el);
    });
    c.appendChild(grid);
}

// Confetti
const ctx = document.getElementById('confettiCanvas').getContext('2d');
let particles = [];
function initConfetti() {
    document.getElementById('confettiCanvas').width = window.innerWidth;
    document.getElementById('confettiCanvas').height = window.innerHeight;
    loopConfetti();
}
function fireConfetti() {
    for(let i=0; i<40; i++) particles.push({
        x: window.innerWidth/2, y: window.innerHeight/2,
        vx: (Math.random()-0.5)*12, vy: (Math.random()-0.5)*12-5,
        color: `hsl(${Math.random()*360},100%,50%)`, life: 80
    });
}
function loopConfetti() {
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    particles.forEach((p,i) => {
        p.x+=p.vx; p.y+=p.vy; p.vy+=0.3; p.life--;
        ctx.fillStyle=p.color; ctx.fillRect(p.x, p.y, 8, 8);
        if(p.life<=0) particles.splice(i,1);
    });
    requestAnimationFrame(loopConfetti);
}
</script>
</body>
</html>